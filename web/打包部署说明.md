# RAGFlow Web æ‰“åŒ…éƒ¨ç½²å®Œæ•´è¯´æ˜

## ğŸ¯ é—®é¢˜æ€»ç»“

ä½ ä¹‹å‰é‡åˆ°çš„ç©ºç™½é¡µé¢é—®é¢˜ä¸»è¦åŸå› æ˜¯ï¼š

1. **è·¯å¾„é…ç½®é”™è¯¯**ï¼šç”Ÿäº§ç¯å¢ƒä¸‹é”™è¯¯åœ°ä½¿ç”¨äº† `/ragflow/` å‰ç¼€ï¼Œå¯¼è‡´é™æ€èµ„æºæ— æ³•æ­£ç¡®åŠ è½½
2. **å¾®åº”ç”¨é…ç½®æ··ä¹±**ï¼šåŒæ—¶å¯ç”¨äº†ç‹¬ç«‹æ¨¡å¼å’Œå¾®åº”ç”¨æ¨¡å¼ï¼Œé€ æˆè·¯ç”±å’Œèµ„æºåŠ è½½å†²çª
3. **ç¯å¢ƒå˜é‡åˆ¤æ–­é”™è¯¯**ï¼šä½¿ç”¨ `NODE_ENV` è€Œä¸æ˜¯ä¸“é—¨çš„ `MICRO_APP` ç¯å¢ƒå˜é‡

## âœ… å·²ä¿®å¤çš„é—®é¢˜

### 1. è·¯å¾„é…ç½®ä¿®å¤
```typescript
// ä¿®å¤å‰ï¼ˆé”™è¯¯ï¼‰ï¼š
base: process.env.NODE_ENV === 'production' ? '/ragflow/' : '/',
publicPath: process.env.NODE_ENV === 'production' ? '/ragflow/' : '/',

// ä¿®å¤åï¼ˆæ­£ç¡®ï¼‰ï¼š
base: process.env.MICRO_APP === 'true' ? '/ragflow/' : '/',
publicPath: process.env.MICRO_APP === 'true' ? '/ragflow/' : '/',
```

### 2. æ¡ä»¶åŒ–å¾®åº”ç”¨é…ç½®
```typescript
// åªåœ¨å¾®åº”ç”¨æ¨¡å¼ä¸‹å¯ç”¨qiankuné…ç½®
...(process.env.MICRO_APP === 'true' && {
  qiankun: {
    slave: {
      devPort: 2080,
      entry: '//localhost:2080',
    },
  },
}),
```

### 3. æ–°å¢æ„å»ºè„šæœ¬
```json
{
  "scripts": {
    "build": "umi build",                    // ç‹¬ç«‹åº”ç”¨æ„å»º
    "build:micro": "cross-env MICRO_APP=true umi build",  // å¾®åº”ç”¨æ„å»º
    "dev": "cross-env HMR=none UMI_DEV_SERVER_COMPRESS=none umi dev", // ç‹¬ç«‹å¼€å‘
    "dev:micro": "cross-env MICRO_APP=true HMR=none UMI_DEV_SERVER_COMPRESS=none umi dev --port 2080", // å¾®åº”ç”¨å¼€å‘
    "serve": "npm run build:copy && npm run start:prod",  // ç‹¬ç«‹éƒ¨ç½²
    "serve:micro": "npm run build:micro && cp -r public/pdfjs-dist dist/ && npm run start:prod" // å¾®åº”ç”¨éƒ¨ç½²
  }
}
```

## ğŸ“‹ ä½¿ç”¨æŒ‡å—

### ğŸš€ ç‹¬ç«‹åº”ç”¨æ¨¡å¼ï¼ˆæ¨èç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰

#### å¼€å‘æ¨¡å¼
```bash
npm run dev
# è®¿é—®ï¼šhttp://localhost:8000
```

#### æ„å»ºå’Œéƒ¨ç½²
```bash
# æ„å»º
npm run build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm run serve

# æˆ–è€…åˆ†æ­¥æ‰§è¡Œ
npm run build
npm run build:copy  # å¤åˆ¶é™æ€èµ„æº
npm run start:prod  # å¯åŠ¨æœåŠ¡å™¨
```

#### ç‰¹ç‚¹
- âœ… å®Œå…¨ç‹¬ç«‹è¿è¡Œï¼Œæ— ä»»ä½•å¤–éƒ¨ä¾èµ–
- âœ… è·¯å¾„é…ç½®ç®€æ´ï¼Œèµ„æºåŠ è½½æ­£ç¡®
- âœ… é€‚åˆç‹¬ç«‹éƒ¨ç½²å’Œç”Ÿäº§ç¯å¢ƒ
- âœ… æ€§èƒ½æœ€ä¼˜ï¼Œæ— é¢å¤–å¼€é”€

### ğŸ”— å¾®åº”ç”¨æ¨¡å¼ï¼ˆç”¨äºé›†æˆåˆ°ä¸»åº”ç”¨ï¼‰

#### å¼€å‘æ¨¡å¼
```bash
npm run dev:micro
# å¾®åº”ç”¨è¿è¡Œåœ¨ï¼šhttp://localhost:2080
```

#### æ„å»ºå’Œéƒ¨ç½²
```bash
# æ„å»ºå¾®åº”ç”¨ç‰ˆæœ¬
npm run build:micro

# éƒ¨ç½²å¾®åº”ç”¨
npm run serve:micro
```

#### ç‰¹ç‚¹
- ğŸ”— å¯ä»¥è¢«å…¶ä»–åº”ç”¨é€šè¿‡qiankuné›†æˆ
- ğŸ¯ æ”¯æŒè·¯ç”±éš”ç¦»å’Œæ ·å¼éš”ç¦»
- ğŸš€ æ”¯æŒçƒ­æ’æ‹”å’ŒåŠ¨æ€åŠ è½½
- ğŸ“¦ èµ„æºè·¯å¾„ä½¿ç”¨ `/ragflow/` å‰ç¼€

## ğŸŒ éƒ¨ç½²æ–¹å¼é€‰æ‹©

### æ–¹å¼ä¸€ï¼šç‹¬ç«‹éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# 1. æ„å»ºé¡¹ç›®
npm run build

# 2. å¯åŠ¨æœåŠ¡å™¨
npm run start:prod

# 3. è®¿é—®åº”ç”¨
# http://localhost:2080
```

**é€‚ç”¨åœºæ™¯ï¼š**
- ç‹¬ç«‹çš„RAGFlowéƒ¨ç½²
- ä¸éœ€è¦ä¸å…¶ä»–ç³»ç»Ÿé›†æˆ
- è¿½æ±‚æœ€ä½³æ€§èƒ½å’Œç¨³å®šæ€§

### æ–¹å¼äºŒï¼šå¾®åº”ç”¨é›†æˆ

```bash
# 1. æ„å»ºå¾®åº”ç”¨ç‰ˆæœ¬
npm run build:micro

# 2. åœ¨ä¸»åº”ç”¨ä¸­é›†æˆ
# å‚è€ƒ auth-integration-test.html ç¤ºä¾‹
```

**é€‚ç”¨åœºæ™¯ï¼š**
- éœ€è¦é›†æˆåˆ°ç°æœ‰çš„Vue/Reactä¸»åº”ç”¨
- å¤šä¸ªç³»ç»Ÿçš„ç»Ÿä¸€é—¨æˆ·
- éœ€è¦å…±äº«è®¤è¯å’ŒçŠ¶æ€

### æ–¹å¼ä¸‰ï¼šé™æ€æ–‡ä»¶éƒ¨ç½²

```bash
# 1. æ„å»ºé¡¹ç›®
npm run build

# 2. å°† dist ç›®å½•éƒ¨ç½²åˆ° Nginx/Apache
# 3. é…ç½®åå‘ä»£ç†åˆ°åç«¯API
```

**Nginxé…ç½®ç¤ºä¾‹ï¼š**
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    # é™æ€æ–‡ä»¶
    location / {
        root /path/to/ragflow/web/dist;
        try_files $uri $uri/ /index.html;
    }
    
    # APIä»£ç†
    location /v1/ {
        proxy_pass http://your-backend:9380;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## ğŸ”§ é«˜çº§é…ç½®

### ç¯å¢ƒå˜é‡è¯´æ˜

| å˜é‡å | ä½œç”¨ | å¯é€‰å€¼ | é»˜è®¤å€¼ |
|--------|------|--------|--------|
| `NODE_ENV` | Node.jsç¯å¢ƒ | `development`, `production` | `development` |
| `MICRO_APP` | å¾®åº”ç”¨æ¨¡å¼å¼€å…³ | `true`, `false` | `false` |
| `DISABLE_DEV_INSPECTOR` | ç¦ç”¨å¼€å‘è€…å·¥å…· | `true`, `false` | `false` |
| `DISABLE_HOT_RELOAD` | ç¦ç”¨çƒ­é‡è½½ | `true`, `false` | `false` |

### è‡ªå®šä¹‰é…ç½®

å¦‚æœéœ€è¦ä¿®æ”¹ç«¯å£æˆ–å…¶ä»–é…ç½®ï¼š

```typescript
// .umirc.ts
export default defineConfig({
  // è‡ªå®šä¹‰å¼€å‘ç«¯å£
  devServer: {
    port: 8080, // ä¿®æ”¹ä¸ºä½ æƒ³è¦çš„ç«¯å£
  },
  
  // è‡ªå®šä¹‰APIä»£ç†
  proxy: {
    '/v1': {
      target: 'http://your-backend-server:port', // ä¿®æ”¹ä¸ºä½ çš„åç«¯åœ°å€
      changeOrigin: true,
    },
  },
});
```

## ğŸš¨ å¸¸è§é—®é¢˜è§£å†³

### 1. ç©ºç™½é¡µé¢é—®é¢˜
**ç°è±¡**ï¼šæ‰“å¼€åº”ç”¨æ˜¾ç¤ºç©ºç™½é¡µé¢

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„æ„å»ºå‘½ä»¤
npm run build  # è€Œä¸æ˜¯ npm run build:micro

# æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
# é€šå¸¸æ˜¯èµ„æºè·¯å¾„é”™è¯¯å¯¼è‡´
```

### 2. èµ„æº404é”™è¯¯
**ç°è±¡**ï¼šCSS/JSæ–‡ä»¶404é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥æ˜¯å¦æ­£ç¡®å¤åˆ¶äº†é™æ€èµ„æº
npm run build:copy

# ç¡®ä¿æœåŠ¡å™¨é…ç½®æ­£ç¡®
# æ£€æŸ¥ simple-server.js ä¸­çš„è·¯å¾„é…ç½®
```

### 3. APIè¯·æ±‚å¤±è´¥
**ç°è±¡**ï¼šå‰ç«¯æ— æ³•è¯·æ±‚åç«¯API

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// ä¿®æ”¹ .umirc.ts ä¸­çš„ä»£ç†é…ç½®
proxy: {
  '/v1': {
    target: 'http://your-correct-backend-url:port',
    changeOrigin: true,
  },
}
```

### 4. å¾®åº”ç”¨é›†æˆå¤±è´¥
**ç°è±¡**ï¼šåœ¨ä¸»åº”ç”¨ä¸­æ— æ³•åŠ è½½RAGFlow

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ç¡®ä¿ä½¿ç”¨å¾®åº”ç”¨æ„å»º
npm run build:micro

# æ£€æŸ¥ä¸»åº”ç”¨çš„qiankuné…ç½®
# å‚è€ƒæä¾›çš„é›†æˆç¤ºä¾‹
```

## ğŸ“ æœ€ä½³å®è·µ

### 1. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- ä½¿ç”¨ `npm run build` æ„å»ºç‹¬ç«‹åº”ç”¨
- é…ç½®åå‘ä»£ç†åˆ°åç«¯API
- å¯ç”¨gzipå‹ç¼©å‡å°‘ä¼ è¾“ä½“ç§¯
- é…ç½®CDNåŠ é€Ÿé™æ€èµ„æº

### 2. å¼€å‘ç¯å¢ƒ
- ä½¿ç”¨ `npm run dev` è¿›è¡Œå¼€å‘
- ä¿®æ”¹ `.umirc.ts` ä¸­çš„ä»£ç†é…ç½®è¿æ¥åˆ°æœ¬åœ°åç«¯
- å¯ç”¨çƒ­é‡è½½æé«˜å¼€å‘æ•ˆç‡

### 3. å¾®åº”ç”¨é›†æˆ
- åªåœ¨éœ€è¦é›†æˆæ—¶ä½¿ç”¨ `npm run build:micro`
- ç¡®ä¿ä¸»åº”ç”¨å’Œå¾®åº”ç”¨çš„qiankunç‰ˆæœ¬å…¼å®¹
- æ³¨æ„æ ·å¼éš”ç¦»å’Œå…¨å±€å˜é‡å†²çª

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°å…¶ä»–é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. **æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯**
2. **ç½‘ç»œè¯·æ±‚æ˜¯å¦æ­£å¸¸**
3. **åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œæ­£å¸¸**
4. **æ„å»ºè¾“å‡ºæ˜¯å¦æœ‰é”™è¯¯**

æŒ‰ç…§ä»¥ä¸ŠæŒ‡å—ï¼Œä½ çš„RAGFlowåº”ç”¨åº”è¯¥èƒ½å¤Ÿæ­£å¸¸å·¥ä½œäº†ï¼ğŸ‰ 