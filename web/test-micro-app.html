<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAGFlow å¾®åº”ç”¨æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            font-weight: bold;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        #ragflow-container {
            width: 100%;
            height: 600px;
            border: 2px solid #ddd;
            border-radius: 5px;
            margin-top: 20px;
            position: relative;
        }
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            color: #666;
        }
        .controls {
            margin: 20px 0;
            text-align: center;
        }
        button {
            margin: 0 10px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        .logs {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ RAGFlow å¾®åº”ç”¨æµ‹è¯•é¡µé¢</h1>
            <p>ç”¨äºæµ‹è¯• RAGFlow ä½œä¸º qiankun å¾®åº”ç”¨çš„åŠŸèƒ½</p>
        </div>

        <div id="status" class="status info">
            ğŸ“¡ æ­£åœ¨æ£€æµ‹å¾®åº”ç”¨çŠ¶æ€...
        </div>

        <div class="controls">
            <button class="btn-primary" onclick="loadMicroApp()">åŠ è½½å¾®åº”ç”¨</button>
            <button class="btn-success" onclick="checkStatus()">æ£€æŸ¥çŠ¶æ€</button>
            <button class="btn-danger" onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
        </div>

        <div id="ragflow-container">
            <div class="loading">ç­‰å¾…å¾®åº”ç”¨åŠ è½½...</div>
        </div>

        <div class="logs" id="logs">
            <div><strong>æ—¥å¿—è¾“å‡º:</strong></div>
        </div>
    </div>

    <script src="https://unpkg.com/qiankun@2.10.16/dist/index.umd.min.js"></script>
    <script>
        let microApp = null;
        let isLoaded = false;

        function log(message, type = 'info') {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #666;">[${timestamp}]</span> ${message}`;
            logs.appendChild(logEntry);
            logs.scrollTop = logs.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

                 function checkStatus() {
             fetch('http://localhost:9222/umi.js')
                 .then(response => {
                     if (response.ok) {
                         updateStatus('âœ… å¾®åº”ç”¨æœåŠ¡å™¨è¿è¡Œæ­£å¸¸', 'success');
                         log('å¾®åº”ç”¨æœåŠ¡å™¨è¿æ¥æˆåŠŸ');
                         return response.text();
                     } else {
                         throw new Error(`HTTP ${response.status}`);
                     }
                 })
                 .then(jsContent => {
                     if (jsContent.includes('ragflow-web')) {
                         log('âœ… æ£€æµ‹åˆ°æ­£ç¡®çš„ UMD æ¨¡å—å¯¼å‡º');
                     } else {
                         log('âš ï¸ æœªæ£€æµ‹åˆ° UMD æ¨¡å—å¯¼å‡º');
                     }
                     
                     if (jsContent.includes('bootstrap') && jsContent.includes('mount') && jsContent.includes('unmount')) {
                         log('âœ… æ£€æµ‹åˆ° qiankun ç”Ÿå‘½å‘¨æœŸå‡½æ•°');
                     } else {
                         log('âš ï¸ æœªæ£€æµ‹åˆ°å®Œæ•´çš„ qiankun ç”Ÿå‘½å‘¨æœŸå‡½æ•°');
                     }
                 })
                 .catch(error => {
                     updateStatus(`âŒ æ— æ³•è¿æ¥åˆ°å¾®åº”ç”¨æœåŠ¡å™¨: ${error.message}`, 'error');
                     log(`è¿æ¥å¤±è´¥: ${error.message}`, 'error');
                 });
         }

        function loadMicroApp() {
            if (isLoaded) {
                log('å¾®åº”ç”¨å·²ç»åŠ è½½ï¼Œæ­£åœ¨é‡æ–°åŠ è½½...');
                if (microApp) {
                    microApp.unmount();
                }
            }

            log('å¼€å§‹åŠ è½½å¾®åº”ç”¨...');
            updateStatus('ğŸ”„ æ­£åœ¨åŠ è½½å¾®åº”ç”¨...', 'info');

                         try {
                 microApp = qiankun.loadMicroApp({
                     name: 'ragflow',
                     entry: 'http://localhost:9222/ragflow/',
                     container: '#ragflow-container',
                     props: {
                         routerBase: '/ragflow',
                         test: true
                     }
                 });

                microApp.mountPromise
                    .then(() => {
                        log('âœ… å¾®åº”ç”¨åŠ è½½æˆåŠŸï¼');
                        updateStatus('âœ… å¾®åº”ç”¨å·²æˆåŠŸåŠ è½½', 'success');
                        isLoaded = true;
                    })
                    .catch(error => {
                        log(`âŒ å¾®åº”ç”¨åŠ è½½å¤±è´¥: ${error.message}`);
                        updateStatus(`âŒ å¾®åº”ç”¨åŠ è½½å¤±è´¥: ${error.message}`, 'error');
                    });

            } catch (error) {
                log(`âŒ åŠ è½½å¾®åº”ç”¨æ—¶å‘ç”Ÿé”™è¯¯: ${error.message}`);
                updateStatus(`âŒ åŠ è½½å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function clearLogs() {
            const logs = document.getElementById('logs');
            logs.innerHTML = '<div><strong>æ—¥å¿—è¾“å‡º:</strong></div>';
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥çŠ¶æ€
        window.onload = function() {
            log('æµ‹è¯•é¡µé¢å·²åŠ è½½');
            checkStatus();
        };

        // æ·»åŠ å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', function(event) {
            log(`âŒ å…¨å±€é”™è¯¯: ${event.error?.message || event.message}`);
        });

        // æ·»åŠ  qiankun é”™è¯¯å¤„ç†
        if (window.qiankun) {
            qiankun.addErrorHandler((error) => {
                log(`âŒ qiankun é”™è¯¯: ${error.message}`);
                updateStatus(`âŒ qiankun é”™è¯¯: ${error.message}`, 'error');
            });
        }
    </script>
</body>
</html> 